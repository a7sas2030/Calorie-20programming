<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø³Ø¹Ø±Ø§Øª ÙˆØ§Ù„ØµØ­Ø© (Ù…Ø¹ BMI)</title>
    <style>
        :root {
            --primary: #4CAF50;
            --secondary: #FF9800;
            --accent: #2196F3;
            --bg: #f4f7f6;
            --card-bg: #ffffff;
            --text: #333;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 15px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        h1, h2 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box;
        }

        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            width: 100%;
            margin-top: 10px;
            transition: background 0.3s;
        }

        button:hover {
            background-color: #45a049;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„ÙˆØ¬Ø¨Ø§Øª */
        .meal-card {
            border-top: 4px solid var(--secondary);
        }

        .food-list {
            list-style: none;
            padding: 0;
            min-height: 50px;
        }

        .food-item {
            background: #f9f9f9;
            border-bottom: 1px solid #eee;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 4px;
            margin-bottom: 5px;
        }

        .delete-btn {
            background-color: #ff4444;
            width: auto;
            padding: 5px 10px;
            margin: 0;
            font-size: 12px;
        }

        /* Ù…Ù„Ø®Øµ Ø´Ø§Ù…Ù„ ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ */
        .main-summary {
            background: linear-gradient(135deg, #2196F3, #21CBF3);
            color: white;
            padding: 20px;
            border-radius: 10px;
            display: flex;
            justify-content: space-around;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(33, 150, 243, 0.3);
        }

        .summary-box h3 { margin: 0; font-size: 1rem; opacity: 0.9; }
        .summary-box p { margin: 5px 0 0; font-size: 1.5rem; font-weight: bold; }

        /* ØªÙ†Ø³ÙŠÙ‚ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª */
        .calculation-results {
            background-color: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: center;
            display: none; /* Ù…Ø®ÙÙŠ Ø­ØªÙ‰ Ø§Ù„Ø­Ø³Ø§Ø¨ */
        }

        .bmi-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
            margin-top: 5px;
        }

        .details-toggle {
            background: #2196F3;
            font-size: 12px;
            padding: 5px;
            width: auto;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³Ø¹Ø±Ø§Øª ÙˆØ§Ù„ØµØ­Ø©</h1>

    <!-- Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø¹Ø§Ù… -->
    <div class="main-summary">
        <div class="summary-box">
            <h3>Ø§Ù„Ù…Ø£ÙƒÙˆÙ„ Ø§Ù„ÙŠÙˆÙ…</h3>
            <p id="totalEaten">0</p>
        </div>
        <div class="summary-box">
            <h3>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</h3>
            <p id="remainingCalories">--</p>
        </div>
    </div>

    <!-- Ù‚Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© -->
    <div class="card">
        <button class="details-toggle" onclick="toggleDetails()">Ø¥Ø®ÙØ§Ø¡ / Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ø³Ù…</button>
        <div id="personalDetails" style="display:none;">
            <h2>Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø±Ø§Øª Ùˆ BMI</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <div class="form-group">
                    <label>Ø§Ù„ÙˆØ²Ù† (ÙƒØ¬Ù…):</label>
                    <input type="number" id="weight" placeholder="70">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ø·ÙˆÙ„ (Ø³Ù…):</label>
                    <input type="number" id="height" placeholder="175">
                </div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <div class="form-group">
                    <label>Ø§Ù„Ø¹Ù…Ø±:</label>
                    <input type="number" id="age" placeholder="25">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ø¬Ù†Ø³:</label>
                    <select id="gender">
                        <option value="male">Ø°ÙƒØ±</option>
                        <option value="female">Ø£Ù†Ø«Ù‰</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù†Ø´Ø§Ø·:</label>
                <select id="activity">
                    <option value="1.2">Ø®Ø§Ù…Ù„</option>
                    <option value="1.375">Ø®ÙÙŠÙ</option>
                    <option value="1.55">Ù…ØªÙˆØ³Ø·</option>
                    <option value="1.725">Ù†Ø´ÙŠØ·</option>
                </select>
            </div>
            <button onclick="calculateNeeds()">Ø§Ø­Ø³Ø¨ (Ø§Ù„Ø³Ø¹Ø±Ø§Øª + Ù…Ø¤Ø´Ø± ÙƒØªÙ„Ø© Ø§Ù„Ø¬Ø³Ù…)</button>
            
            <div id="healthResults" class="calculation-results">
                <p style="margin: 5px 0;">Ø§Ø­ØªÙŠØ§Ø¬Ùƒ Ø§Ù„ÙŠÙˆÙ…ÙŠ: <strong id="targetDisplay" style="color: var(--primary);"></strong> Ø³Ø¹Ø±Ø©</p>
                <hr style="margin: 10px 0; border: 0; border-top: 1px solid #ccc;">
                <p style="margin: 5px 0;">Ù…Ø¤Ø´Ø± ÙƒØªÙ„Ø© Ø§Ù„Ø¬Ø³Ù…: <strong id="bmiValue"></strong></p>
                <span id="bmiStatus" class="bmi-badge"></span>
            </div>
        </div>
    </div>

    <!-- Ù…Ù†Ø·Ù‚Ø© Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø¹Ø§Ù… -->
    <div class="card" style="border: 2px solid var(--primary);">
        <h2 style="margin-top:0;">â• Ø¥Ø¶Ø§ÙØ© Ø·Ø¹Ø§Ù…</h2>
        <div class="form-group">
            <label>Ø¥Ù„Ù‰ Ø£ÙŠ ÙˆØ¬Ø¨Ø©ØŸ</label>
            <select id="mealSelect" style="font-weight:bold; background-color: #f0f8ff;">
                <option value="ÙØ·ÙˆØ±">ğŸ³ Ø§Ù„ÙØ·ÙˆØ±</option>
                <option value="ØºØ¯Ø§">ğŸ— Ø§Ù„ØºØ¯Ø§</option>
                <option value="Ø¹Ø´Ø§Ø¡">ğŸŒ™ Ø§Ù„Ø¹Ø´Ø§Ø¡</option>
            </select>
        </div>
        <div class="form-group">
            <label>Ù†ÙˆØ¹ Ø§Ù„Ø·Ø¹Ø§Ù…:</label>
            <select id="foodSelect" onchange="calculatePreview()">
                <option value="rice" data-cal="130">Ø£Ø±Ø² (Ø£Ø¨ÙŠØ¶) - 130/100Ø¬Ù…</option>
                <option value="bread" data-cal="265">Ø®Ø¨Ø² Ø¹Ø±Ø¨ÙŠ - 265/100Ø¬Ù…</option>
                <option value="chicken" data-cal="165">Ø¯Ø¬Ø§Ø¬ (ØµØ¯Ø±) - 165/100Ø¬Ù…</option>
                <option value="meat" data-cal="250">Ù„Ø­Ù… Ø£Ø­Ù…Ø± - 250/100Ø¬Ù…</option>
                <option value="egg" data-cal="155">Ø¨ÙŠØ¶Ø© - 155/100Ø¬Ù…</option>
                <option value="lentils" data-cal="116">Ø¹Ø¯Ø³ - 116/100Ø¬Ù…</option>
                <option value="oil" data-cal="884">Ø²ÙŠØª/Ø·Ø­ÙŠÙ†ÙŠØ© - 884/100Ø¬Ù…</option>
                <option value="apple" data-cal="52">ØªÙØ§Ø­Ø© - 52/100Ø¬Ù…</option>
                <option value="banana" data-cal="89">Ù…ÙˆØ²Ø© - 89/100Ø¬Ù…</option>
                <option value="yogurt" data-cal="59">Ø²Ø¨Ø§Ø¯ÙŠ - 59/100Ø¬Ù…</option>
                <option value="cheese" data-cal="350">Ø¬Ø¨Ù† - 350/100Ø¬Ù…</option>
                <option value="milk" data-cal="65">Ø­Ù„ÙŠØ¨ - 65/100Ø¬Ù…</option>
                <option value="coffee" data-cal="2">Ù‚Ù‡ÙˆØ©/Ø´Ø§ÙŠ (Ø¨Ø¯ÙˆÙ† Ø³ÙƒØ±) - 2/100Ø¬Ù…</option>
            </select>
        </div>
        <div class="form-group">
            <label>Ø§Ù„ÙƒÙ…ÙŠØ© (Ø¬Ø±Ø§Ù…):</label>
            <input type="number" id="foodQty" placeholder="100" oninput="calculatePreview()">
        </div>
        <p style="text-align: center; margin-bottom: 10px;">Ø³Ø¹Ø±Ø§Øª Ù‡Ø°Ù‡ Ø§Ù„Ø¥Ø¶Ø§ÙØ©: <strong id="previewCalories">0</strong> Ø³Ø¹Ø±Ø©</p>
        <button onclick="addFood()">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
    </div>

    <!-- ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ù„ÙˆØ¬Ø¨Ø§Øª -->
    <div class="card meal-card">
        <h3>ğŸ³ ÙˆØ¬Ø¨Ø© Ø§Ù„ÙØ·ÙˆØ±</h3>
        <ul id="list-fotor" class="food-list"></ul>
        <p style="text-align: left; color: #666; font-size: 0.9em;">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ·ÙˆØ±: <span id="sum-fotor">0</span> Ø³Ø¹Ø±Ø©</p>
    </div>

    <div class="card meal-card">
        <h3>ğŸ— ÙˆØ¬Ø¨Ø© Ø§Ù„ØºØ¯Ø§</h3>
        <ul id="list-ghada" class="food-list"></ul>
        <p style="text-align: left; color: #666; font-size: 0.9em;">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ØºØ¯Ø§: <span id="sum-ghada">0</span> Ø³Ø¹Ø±Ø©</p>
    </div>

    <div class="card meal-card">
        <h3>ğŸŒ™ ÙˆØ¬Ø¨Ø© Ø§Ù„Ø¹Ø´Ø§Ø¡</h3>
        <ul id="list-asha" class="food-list"></ul>
        <p style="text-align: left; color: #666; font-size: 0.9em;">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø¹Ø´Ø§Ø¡: <span id="sum-asha">0</span> Ø³Ø¹Ø±Ø©</p>
    </div>

</div>

<script>
    let targetCalories = 2000;
    let mealLog = {
        'ÙØ·ÙˆØ±': [],
        'ØºØ¯Ø§': [],
        'Ø¹Ø´Ø§Ø¡': []
    };

    window.onload = function() {
        loadData();
        renderAllMeals();
        updateTotals();
    };

    function calculateNeeds() {
        const weight = parseFloat(document.getElementById('weight').value);
        const height = parseFloat(document.getElementById('height').value);
        const age = parseFloat(document.getElementById('age').value);
        const gender = document.getElementById('gender').value;
        const activity = parseFloat(document.getElementById('activity').value);

        if (!weight || !height || !age) {
            alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ÙˆØ²Ù†ØŒ Ø§Ù„Ø·ÙˆÙ„ ÙˆØ§Ù„Ø¹Ù…Ø±");
            return;
        }

        // 1. Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø¹Ø±Ø§Øª (BMR & TDEE)
        let bmr;
        if (gender === 'male') {
            bmr = (10 * weight) + (6.25 * height) - (5 * age) + 5;
        } else {
            bmr = (10 * weight) + (6.25 * height) - (5 * age) - 161;
        }
        targetCalories = Math.round(bmr * activity);

        // 2. Ø­Ø³Ø§Ø¨ Ù…Ø¤Ø´Ø± ÙƒØªÙ„Ø© Ø§Ù„Ø¬Ø³Ù… (BMI)
        const heightInMeters = height / 100;
        const bmi = (weight / (heightInMeters * heightInMeters)).toFixed(1);
        
        // ØªØµÙ†ÙŠÙ BMI
        let bmiCategory = "";
        let colorCode = "";
        if (bmi < 18.5) {
            bmiCategory = "Ù†Ø­Ø§ÙØ©";
            colorCode = "#2196F3"; // Ø£Ø²Ø±Ù‚
        } else if (bmi >= 18.5 && bmi < 24.9) {
            bmiCategory = "ÙˆØ²Ù† Ù…Ø«Ø§Ù„ÙŠ";
            colorCode = "#4CAF50"; // Ø£Ø®Ø¶Ø±
        } else if (bmi >= 25 && bmi < 29.9) {
            bmiCategory = "Ø²ÙŠØ§Ø¯Ø© ÙˆØ²Ù†";
            colorCode = "#FF9800"; // Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ
        } else {
            bmiCategory = "Ø³Ù…Ù†Ø©";
            colorCode = "#f44336"; // Ø£Ø­Ù…Ø±
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        document.getElementById('targetDisplay').innerText = targetCalories;
        document.getElementById('bmiValue').innerText = bmi;
        
        const statusEl = document.getElementById('bmiStatus');
        statusEl.innerText = bmiCategory;
        statusEl.style.backgroundColor = colorCode;
        
        document.getElementById('healthResults').style.display = 'block';
        
        updateTotals();
    }

    function calculatePreview() {
        const select = document.getElementById('foodSelect');
        const calPer100g = parseFloat(select.options[select.selectedIndex].getAttribute('data-cal'));
        const qty = parseFloat(document.getElementById('foodQty').value) || 0;
        const total = Math.round((calPer100g * qty) / 100);
        document.getElementById('previewCalories').innerText = total;
        return total;
    }

    function addFood() {
        const mealType = document.getElementById('mealSelect').value;
        const select = document.getElementById('foodSelect');
        const foodName = select.options[select.selectedIndex].text.split('-')[0];
        const qty = document.getElementById('foodQty').value;
        const itemCalories = calculatePreview();

        if (qty <= 0) {
            alert("ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© ÙƒÙ…ÙŠØ© ØµØ­ÙŠØ­Ø©");
            return;
        }

        mealLog[mealType].push({
            name: foodName,
            qty: qty,
            cal: itemCalories
        });

        saveData();
        
        document.getElementById('foodQty').value = '';
        document.getElementById('previewCalories').innerText = '0';
        
        renderAllMeals();
        updateTotals();
    }

    function removeFood(mealType, index) {
        mealLog[mealType].splice(index, 1);
        saveData();
        renderAllMeals();
        updateTotals();
    }

    function renderAllMeals() {
        renderSingleMeal('ÙØ·ÙˆØ±', 'list-fotor', 'sum-fotor');
        renderSingleMeal('ØºØ¯Ø§', 'list-ghada', 'sum-ghada');
        renderSingleMeal('Ø¹Ø´Ø§Ø¡', 'list-asha', 'sum-asha');
    }

    function renderSingleMeal(mealType, listElementId, sumElementId) {
        const ul = document.getElementById(listElementId);
        ul.innerHTML = '';
        const items = mealLog[mealType];
        let mealSum = 0;

        items.forEach((item, index) => {
            mealSum += item.cal;
            const li = document.createElement('li');
            li.className = 'food-item';
            li.innerHTML = `
                <span>${item.name} (${item.qty} Ø¬Ù…)</span>
                <div>
                    <span style="margin-left:10px; font-weight:bold;">${item.cal} Ø³Ø¹Ø±Ø©</span>
                    <button class="delete-btn" onclick="removeFood('${mealType}', ${index})">x</button>
                </div>
            `;
            ul.appendChild(li);
        });

        if(items.length === 0) {
            ul.innerHTML = '<li style="text-align:center; color:#ccc; font-size:0.8em;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ±</li>';
        }

        document.getElementById(sumElementId).innerText = mealSum;
    }

    function updateTotals() {
        let totalEaten = 0;
        Object.values(mealLog).forEach(items => {
            totalEaten += items.reduce((sum, item) => sum + item.cal, 0);
        });

        document.getElementById('totalEaten').innerText = totalEaten;
        
        const remaining = targetCalories - totalEaten;
        const remainingEl = document.getElementById('remainingCalories');
        remainingEl.innerText = remaining;
        
        if(remaining < 0) {
            remainingEl.style.color = '#ffcccc';
        } else {
            remainingEl.style.color = 'white';
        }
    }

    function toggleDetails() {
        const div = document.getElementById('personalDetails');
        div.style.display = div.style.display === 'none' ? 'block' : 'none';
    }

    function saveData() {
        localStorage.setItem('mealTracker_v3_log', JSON.stringify(mealLog));
        localStorage.setItem('mealTracker_v3_target', targetCalories);
        // Ù†Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø© Ø£ÙŠØ¶Ø§Ù‹ Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù€ BMI ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ø¹ÙˆØ¯Ø©
        localStorage.setItem('mealTracker_v3_weight', document.getElementById('weight').value);
        localStorage.setItem('mealTracker_v3_height', document.getElementById('height').value);
        localStorage.setItem('mealTracker_v3_age', document.getElementById('age').value);
        localStorage.setItem('mealTracker_v3_gender', document.getElementById('gender').value);
        localStorage.setItem('mealTracker_v3_activity', document.getElementById('activity').value);
    }

    function loadData() {
        const savedLog = localStorage.getItem('mealTracker_v3_log');
        const savedTarget = localStorage.getItem('mealTracker_v3_target');

        if (savedLog) {
            mealLog = JSON.parse(savedLog);
        }
        if (savedTarget) {
            targetCalories = parseInt(savedTarget);
        }

        // Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø© ÙˆÙ…Ù„Ø¡ Ø§Ù„Ø­Ù‚ÙˆÙ„
        const savedWeight = localStorage.getItem('mealTracker_v3_weight');
        const savedHeight = localStorage.getItem('mealTracker_v3_height');
        const savedAge = localStorage.getItem('mealTracker_v3_age');
        const savedGender = localStorage.getItem('mealTracker_v3_gender');
        const savedActivity = localStorage.getItem('mealTracker_v3_activity');

        if (savedWeight && savedHeight && savedAge) {
            document.getElementById('weight').value = savedWeight;
            document.getElementById('height').value = savedHeight;
            document.getElementById('age').value = savedAge;
            document.getElementById('gender').value = savedGender;
            document.getElementById('activity').value = savedActivity;
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ¬ÙˆØ¯Ø© Ù†Ù‚ÙˆÙ… Ø¨Ø§Ù„Ø­Ø³Ø§Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù€ BMI
            calculateNeeds();
        }
    }
</script>

</body>
</html>